From 334d6e1403e1071a80ee7437fffd7ed09cc18639 Mon Sep 17 00:00:00 2001
From: Yumi Yukimura <me.cafebabe@gmail.com>
Date: Sat, 2 Aug 2025 18:29:21 +0000
Subject: [PATCH 02/21] property_service: Load /system/etc/override.prop

Change-Id: I355b23b433c50b38d8e14b66adddedd3561f8628
---
 init/property_service.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/init/property_service.cpp b/init/property_service.cpp
index eac6f821d..f7dea9b91 100644
--- a/init/property_service.cpp
+++ b/init/property_service.cpp
@@ -76,6 +76,8 @@
 #include "util.h"
 #include "vendor_init.h"
 
+static constexpr char kOverrideProp[] = "/system/etc/override.prop";
+
 static constexpr char APPCOMPAT_OVERRIDE_PROP_FOLDERNAME[] =
         "/dev/__properties__/appcompat_override";
 static constexpr char APPCOMPAT_OVERRIDE_PROP_TREE_FILE[] =
@@ -1232,6 +1234,14 @@ void PropertyLoadBootDefaults() {
         }
     }
 
+    if (access(kOverrideProp, R_OK) == 0) {
+        LOG(INFO) << "Loading " << kOverrideProp;
+        if (auto res = load_properties_from_file(kOverrideProp, nullptr, &properties);
+            !res.ok()) {
+            LOG(WARNING) << res.error();
+        }
+    }
+
     for (const auto& [name, value] : properties) {
         std::string error;
         if (PropertySetNoSocket(name, value, &error) != PROP_SUCCESS) {
-- 
2.47.3

