From 487ecdd3cbd3144a862187cd5832a4ec408fc634 Mon Sep 17 00:00:00 2001
From: Yumi Yukimura <me.cafebabe@gmail.com>
Date: Tue, 5 Aug 2025 16:57:14 +0800
Subject: [PATCH 30/30] Add generic dumb driver

Change-Id: Ie9829a38c8ac541a5ba92981aab9381befa2dd85
---
 drv.c         | 4 ++++
 dumb_driver.c | 1 +
 2 files changed, 5 insertions(+)

diff --git a/drv.c b/drv.c
index bab5fb2..e8c19fd 100644
--- a/drv.c
+++ b/drv.c
@@ -55,6 +55,7 @@ extern const struct backend backend_vmwgfx;
 #endif
 
 // Dumb / generic drivers
+extern const struct backend backend_dumb_generic;
 extern const struct backend backend_evdi;
 extern const struct backend backend_marvell;
 extern const struct backend backend_mediatek;
@@ -123,6 +124,9 @@ static const struct backend *drv_get_backend(int fd)
 			drv_loge("dmabuf_heap backend is not compiled in\n");
 #endif
 		}
+		if (!strcmp(prop_buf, "dumb_generic")) {
+			return &backend_dumb_generic;
+		}
 		if (!strcmp(prop_buf, "gbm_mesa")) {
 #ifdef DRV_GBM_MESA
 			return &backend_gbm_mesa;
diff --git a/dumb_driver.c b/dumb_driver.c
index f74d237..7b3b3b9 100644
--- a/dumb_driver.c
+++ b/dumb_driver.c
@@ -64,6 +64,7 @@ static int dumb_bo_create_with_modifiers(struct bo *bo, uint32_t width, uint32_t
 	return -EINVAL;
 }
 
+INIT_DUMB_DRIVER(dumb_generic)
 INIT_DUMB_DRIVER(evdi)
 INIT_DUMB_DRIVER(komeda)
 INIT_DUMB_DRIVER(marvell)
-- 
2.39.5

