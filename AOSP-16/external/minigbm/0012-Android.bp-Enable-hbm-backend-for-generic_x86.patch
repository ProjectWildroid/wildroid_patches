From 02da4c7e66960b0bc701b8dc50a768230143e569 Mon Sep 17 00:00:00 2001
From: Yumi Yukimura <me.cafebabe@gmail.com>
Date: Sat, 26 Jul 2025 19:21:03 +0800
Subject: [PATCH 12/30] Android.bp: Enable hbm backend for generic_x86

Change-Id: I288f250572808439e9df6df5b35ce8d50d073e94
---
 Android.bp | 17 +++++++++++++++--
 1 file changed, 15 insertions(+), 2 deletions(-)

diff --git a/Android.bp b/Android.bp
index cb92c31..33f369e 100644
--- a/Android.bp
+++ b/Android.bp
@@ -43,6 +43,7 @@ filegroup {
         "drv_array_helpers.c",
         "drv_helpers.c",
         "dumb_driver.c",
+        "hbm.c",
         "i915.c",
         "mediatek.c",
         "msm.c",
@@ -89,6 +90,10 @@ generic_x86_cflags = arcvm_cflags + generic_cflags + intel_cflags + [
     "-DDRV_VMWGFX",
 ]
 
+generic_x86_cros_gralloc_cflags = [
+    "-DDRV_HBM_HELPER",
+]
+
 cc_defaults {
     name: "minigbm_defaults",
 
@@ -139,6 +144,11 @@ cc_defaults {
 
     defaults: ["minigbm_defaults"],
 
+    cflags: select(soong_config_variable("minigbm", "platform"), {
+        "generic_x86": generic_x86_cros_gralloc_cflags,
+        default: [],
+    }),
+
     header_libs: [
         "libhardware_headers",
         "libnativebase_headers",
@@ -158,7 +168,10 @@ cc_defaults {
         "liblog",
         "libnativewindow",
         "libsync",
-    ],
+    ] + select(soong_config_variable("minigbm", "platform"), {
+        "generic_x86": ["libhbm_minigbm"],
+        default: [],
+    }),
 }
 
 cc_defaults {
@@ -281,7 +294,7 @@ cc_library_headers {
 cc_library_shared {
     name: "libminigbm_gralloc_generic_x86",
     defaults: ["minigbm_cros_gralloc_library_defaults"],
-    cflags: generic_x86_cflags,
+    cflags: generic_x86_cflags + generic_x86_cros_gralloc_cflags,
 }
 
 cc_library_shared {
-- 
2.39.5

