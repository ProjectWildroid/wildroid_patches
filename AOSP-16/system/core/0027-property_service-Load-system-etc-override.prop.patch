From 4967ff8338747517920f1a6334ef22801604751c Mon Sep 17 00:00:00 2001
From: Yumi Yukimura <me.cafebabe@gmail.com>
Date: Sat, 2 Aug 2025 18:29:21 +0000
Subject: [PATCH 27/27] property_service: Load /system/etc/override.prop

Change-Id: I355b23b433c50b38d8e14b66adddedd3561f8628
---
 init/property_service.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/init/property_service.cpp b/init/property_service.cpp
index 095e5f5dcc..03f8b09efd 100644
--- a/init/property_service.cpp
+++ b/init/property_service.cpp
@@ -76,6 +76,8 @@
 #include "util.h"
 #include "vendor_init.h"
 
+static constexpr char kOverrideProp[] = "/system/etc/override.prop";
+
 static constexpr char APPCOMPAT_OVERRIDE_PROP_FOLDERNAME[] =
         "/dev/__properties__/appcompat_override";
 static constexpr char APPCOMPAT_OVERRIDE_PROP_TREE_FILE[] =
@@ -1232,6 +1234,14 @@ void PropertyLoadBootDefaults() {
         }
     }
 
+    if (access(kOverrideProp, R_OK) == 0) {
+        LOG(INFO) << "Loading " << kOverrideProp;
+        if (auto res = load_properties_from_file(kOverrideProp, nullptr, &properties);
+            !res.ok()) {
+            LOG(WARNING) << res.error();
+        }
+    }
+
     for (const auto& [name, value] : properties) {
         std::string error;
         if (PropertySetNoSocket(name, value, &error) != PROP_SUCCESS) {
-- 
2.39.5

