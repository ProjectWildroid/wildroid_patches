From 21e513e845bcd806702e5234e2a3db4ac0cf7eb1 Mon Sep 17 00:00:00 2001
From: Yumi Yukimura <me.cafebabe@gmail.com>
Date: Fri, 18 Jul 2025 21:07:35 +0800
Subject: [PATCH 14/24] first_stage_mount: Do not initialize block device for
 tmpfs/virtiofs mount

Change-Id: I8a1a3e154dfc05a8167326aa754067b601839d79
---
 init/first_stage_mount.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/init/first_stage_mount.cpp b/init/first_stage_mount.cpp
index 3e76641d8a..bbd915c166 100644
--- a/init/first_stage_mount.cpp
+++ b/init/first_stage_mount.cpp
@@ -789,7 +789,8 @@ bool FirstStageMountVBootV2::GetDmVerityDevices(std::set<std::string>* devices)
             // Don't try to find logical partitions via uevent regeneration.
             logical_partitions.emplace(basename(fstab_entry.blk_device.c_str()));
         } else {
-            if (fstab_entry.fs_type != "none" &&
+            if (fstab_entry.fs_type != "none" && fstab_entry.fs_type != "tmpfs" &&
+                fstab_entry.fs_type != "virtiofs" &&
                 !android::base::EndsWithIgnoreCase(fstab_entry.blk_device, ".img")) {
                 devices->emplace(basename(fstab_entry.blk_device.c_str()));
             }
-- 
2.39.5

