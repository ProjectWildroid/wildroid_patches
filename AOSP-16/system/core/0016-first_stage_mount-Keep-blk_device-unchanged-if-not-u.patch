From 17d7587b7dee33ec0735d5320d8884607ef7c048 Mon Sep 17 00:00:00 2001
From: Yumi Yukimura <me.cafebabe@gmail.com>
Date: Sat, 19 Jul 2025 04:11:54 +0800
Subject: [PATCH 16/20] first_stage_mount: Keep blk_device unchanged if not
 updated to /dev/dm-<N>

Change-Id: Icc8da946c94c7ea1540efa3075fba0ba56264843
---
 init/first_stage_mount.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/init/first_stage_mount.cpp b/init/first_stage_mount.cpp
index dd472b345e..e401e84687 100644
--- a/init/first_stage_mount.cpp
+++ b/init/first_stage_mount.cpp
@@ -468,7 +468,7 @@ bool FirstStageMountVBootV2::MountPartition(const Fstab::iterator& begin, bool e
         if (!mounted) {
             // blk_device is already updated to /dev/dm-<N> by SetUpDmVerity() above.
             // Copy it from the begin iterator.
-            current->blk_device = begin->blk_device;
+            if (begin->fs_mgr_flags.avb) current->blk_device = begin->blk_device;
             mounted = (fs_mgr_do_mount_one(*current) == 0);
         }
     }
-- 
2.39.5

